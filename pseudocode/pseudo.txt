\documentclass{article}
\usepackage{algorithm}
\usepackage{algcompatible}

\begin{document}
\begin{algorithm}
\begin{algorithmic} [1]

\FORALL{\texttt{prisoners}}
\STATE verify bus for prisoner by type
\IF{no bus for required type}
\STATE\texttt{setType($prisoner$, $any$)}
\ENDIF
\ENDFOR

\FORALL{\texttt{buses}}
\STATE $destinations$ $\gets$ [ ]
\FORALL{\texttt{prisoners}}
\IF{hasPath($bus$,$prisoner$) and checkType($bus$,$prisoner$)}
\STATE \texttt{add($destinations$, $prisoner$)}
\ENDIF
\ENDFOR
\STATE $busDestinations$ $\gets$ $destinations$
\ENDFOR

\WHILE{any bus destinations not empty}

\STATE $ignoredVertexes$ $\gets$ [ ]

\FORALL{buses}

\IF{!empty($busDestinations$)} 
\STATE $hadAction$ $\gets$ false
\STATE dijkstra($busLocation$)
\STATE $nextDest$ $\gets$ pop($busDestinations$)
\STATE $pathToNext$ $\gets$ getPath($busLocation$, $nextDest$)
\STATE $currentLocation$ $\gets$ $busLocation$
\STATE $busLocation$ $\gets$ $nextDest$


\STATE prisonerLoop:
\FORALL{\texttt{prisoners}}
\IF{$prisionerWeight > busCapacity$}
\STATE \textbf{go to} \emph{prisonerLoop}
\ENDIF
\IF{$prisionerStart$ = $busLocation$ and !pickedUp($prisoner$) and checkType($bus$,$prisoner$)}
\STATE $currentNextDist$ $\gets$ dist($nextDest$)

\FORALL{buses as $bus2$}
\STATE djikstra($bus2Location$)
\STATE $nextDist$ $\gets$ dist($nextDest$)
\STATE $ignoreDest$ $\gets$ false

\FORALL{\texttt{prisoners as $prisoner1$}}
\IF{$bus$ != $bus2$ and pickedUp($prisoner1$) and !delivered($prisoner1$) and getBus($prisoner1$) = $bus2$ and checkType($bus2$,$prisoner1$)}
\STATE dijkstra(destination($prisoner1$))
\IF{dist($nextDest$) < $nextDist$}
\STATE add($ignoredVertexes$, $nextDest$)
\STATE $ignoreDest$ $\gets$ true
\STATE \textbf{break loop}
\ENDIF
\ENDIF
\ENDFOR


\algstore{myalg}
\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\begin{algorithmic} [1]
\algrestore{myalg}


\IF{$ignoreDest$}
\STATE \textbf{break loop}
\ENDIF


\IF{$bus$ != $bus2$ and $currentNextDist > nextDist$ and checkType($bus2$,$prisoner$}
\STATE add($ignoredVertexes$,$nextDest$)
\STATE \textbf{break loop}
\ELSIF{$bus2$ = lastBus}
\IF{canFit($bus$, $prisoner$)}
\STATE pickUp($prisoner$, $bus$)
\STATE add($busDestinations$, destination($prisoner$))
\ENDIF
\ENDIF


\ENDFOR

\ELSIF{destination($prisoner$)=$busLocation$ and pickedUp($prisoner$) and getBus($prisoner$)=$bus$}
\STATE deliver($prisoner$, $bus$)
\STATE $hadAction$ $\gets$ true
\ENDIF

\ENDFOR

\IF{$hadAction$ or empty($busDestinations$)}
\IF{!$hadAction$}
\STATE $busLocation$ $\gets$ $currentLocation$
\ENDIF
\FORALL{$ignoredVertexes$}
\STATE addDestination($bus$, $ignoredVertex$)
\ENDFOR
\STATE $ignoredVertexes$ $\gets$ [ ]
\ELSE
\STATE $busLocation$ $\gets$ $currentLocation$
\STATE \textbf{repeat loop iteration}
\ENDIF

\IF{$hadAction$}
\STATE $results$[$bus$] $\gets$ $pathToNext$
\ENDIF

\ENDIF
\ENDFOR

\ENDWHILE

\end{algorithmic}
\end{algorithm}
\end{document}